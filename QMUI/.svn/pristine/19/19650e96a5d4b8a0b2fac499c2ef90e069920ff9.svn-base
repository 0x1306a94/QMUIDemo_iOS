//
//  QMUIMoreOperationController.h
//  qmui
//
//  Created by zhoon, MoLice on 17/11/15.
//  Copyright (c) 2017年 QMUI Team. All rights reserved.
//

#import <Foundation/Foundation.h>
#import <UIKit/UIKit.h>
#import "QMUIModalPresentationViewController.h"
#import "QMUIButton.h"

@class QMUIMoreOperationController;
@class QMUIMoreOperationItemView;

/// 更多操作面板的delegate。
@protocol QMUIMoreOperationDelegate <NSObject>

@optional
/// 即将显示操作面板
- (void)willPresentMoreOperationController:(QMUIMoreOperationController *)moreOperationController;

/// 已经显示操作面板
- (void)didPresentMoreOperationController:(QMUIMoreOperationController *)moreOperationController;

/// 即将降下操作面板，cancelled参数是用来区分是否触发了maskView或者cancelButton按钮降下面板还是手动调用hide方法来降下面板。
/// TODO: molice 点击遮罩目前暂时无法触发这个 delegate，备忘
- (void)willDismissMoreOperationController:(QMUIMoreOperationController *)moreOperationController cancelled:(BOOL)cancelled;

/// 已经降下操作面板，cancelled参数是用来区分是否触发了maskView或者cancelButton按钮降下面板还是手动调用hide方法来降下面板。
- (void)didDismissMoreOperationController:(QMUIMoreOperationController *)moreOperationController cancelled:(BOOL)cancelled;

/// itemView 点击事件，可以与 itemView.handler 共存
- (void)moreOperationController:(QMUIMoreOperationController *)moreOperationController didSelectItemViewWithTag:(NSInteger)tag;
@end

@interface QMUIMoreOperationItemView : QMUIButton

+ (instancetype)itemViewWithImage:(UIImage *)image
                            title:(NSString *)title
                          handler:(void (^)(QMUIMoreOperationController *moreOperationController, QMUIMoreOperationItemView *itemView))handler;

+ (instancetype)itemViewWithImage:(UIImage *)image
                    selectedImage:(UIImage *)selectedImage
                            title:(NSString *)title
                    selectedTitle:(NSString *)selectedTitle
                          handler:(void (^)(QMUIMoreOperationController *moreOperationController, QMUIMoreOperationItemView *itemView))handler;

+ (instancetype)itemViewWithImage:(UIImage *)image
                    selectedImage:(UIImage *)selectedImage
                            title:(NSString *)title
                    selectedTitle:(NSString *)selectedTitle
                              tag:(NSInteger)tag;

@end


/**
 *  更多操作面板控件，类似系统的相册分享面板，以及微信的 webview 分享面板。功能特性包括：
 *  1. 支持多行，每行支持多个 item，由二维数组 items 控制。
 *  2. 默认自带取消按钮，也可自行隐藏。
 *  3. 支持以 UIAppearance 的方式配置样式皮肤。
 */
@interface QMUIMoreOperationController : UIViewController <QMUIModalPresentationContentViewControllerProtocol>

@property(nonatomic, strong) UIColor *contentBackgroundColor UI_APPEARANCE_SELECTOR;
@property(nonatomic, assign) CGFloat contentEdgeMargin UI_APPEARANCE_SELECTOR;
@property(nonatomic, assign) CGFloat contentMaximumWidth UI_APPEARANCE_SELECTOR;
@property(nonatomic, assign) CGFloat contentCornerRadius UI_APPEARANCE_SELECTOR;
@property(nonatomic, assign) UIEdgeInsets contentPaddings UI_APPEARANCE_SELECTOR;

@property(nonatomic, strong) UIColor *scrollViewSeparatorColor UI_APPEARANCE_SELECTOR;
@property(nonatomic, assign) UIEdgeInsets scrollViewContentInsets UI_APPEARANCE_SELECTOR;

@property(nonatomic, strong) UIColor *itemBackgroundColor UI_APPEARANCE_SELECTOR;
@property(nonatomic, strong) UIColor *itemTitleColor UI_APPEARANCE_SELECTOR;
@property(nonatomic, strong) UIFont  *itemTitleFont UI_APPEARANCE_SELECTOR;
@property(nonatomic, assign) CGFloat itemTitleMarginTop UI_APPEARANCE_SELECTOR;
@property(nonatomic, assign) CGFloat itemMinimumMarginHorizontal UI_APPEARANCE_SELECTOR;

@property(nonatomic, strong) UIColor *cancelButtonBackgroundColor UI_APPEARANCE_SELECTOR;
@property(nonatomic, strong) UIColor *cancelButtonTitleColor UI_APPEARANCE_SELECTOR;
@property(nonatomic, strong) UIColor *cancelButtonSeparatorColor UI_APPEARANCE_SELECTOR;
@property(nonatomic, strong) UIFont  *cancelButtonFont UI_APPEARANCE_SELECTOR;
@property(nonatomic, assign) CGFloat cancelButtonHeight UI_APPEARANCE_SELECTOR;
@property(nonatomic, assign) CGFloat cancelButtonMarginTop UI_APPEARANCE_SELECTOR;

@property(nonatomic, weak) id<QMUIMoreOperationDelegate> delegate;

/// 取消按钮，如果不需要，则自行设置其 hidden 为 YES
@property(nonatomic, strong, readonly) QMUIButton *cancelButton;

/// 在 iPhoneX 机器上是否延伸底部背景色。因为在 iPhoneX 上我们会把整个面板往上移动 safeArea 的距离，如果你的面板本来就配置成撑满全屏的样式，那么就会露出底部的空隙，isExtendBottomLayout 可以帮助你把空暇填补上。默认为NO。
@property(nonatomic, assign) BOOL isExtendBottomLayout UI_APPEARANCE_SELECTOR;

@property(nonatomic, copy) NSArray<NSArray<QMUIMoreOperationItemView *> *> *items;

/// 添加一个 itemView 到指定 section 的末尾
- (void)addItemView:(QMUIMoreOperationItemView *)itemView inSection:(NSInteger)section;

/// 插入一个 itemView 到指定的位置，NSIndexPath 请使用 section-item 组合，其中 section 表示行，item 表示 section 里的元素序号
- (void)insertItemView:(QMUIMoreOperationItemView *)itemView atIndexPath:(NSIndexPath *)indexPath;

/// 移除指定位置的 itemView，NSIndexPath 请使用 section-item 组合，其中 section 表示行，item 表示 section 里的元素序号
- (void)removeItemViewAtIndexPath:(NSIndexPath *)indexPath;

/// 获取指定 tag 的 itemView，如果不存在则返回 nil
- (QMUIMoreOperationItemView *)itemViewWithTag:(NSInteger)tag;

/// 获取指定 itemView 在当前控件里的 indexPath，如果不存在则返回 nil
- (NSIndexPath *)indexPathWithItemView:(QMUIMoreOperationItemView *)itemView;

/// 弹出面板，一般在 init 完并且设置好 items 之后就调用这个接口来显示面板
- (void)showFromBottom;

/// 隐藏面板
- (void)hideToBottom;

/// 更多操作面板是否正在显示
@property(nonatomic, assign, getter=isShowing, readonly) BOOL showing;
@property(nonatomic, assign, getter=isAnimating, readonly) BOOL animating;

@end


@interface QMUIMoreOperationController (UIAppearance)

+ (instancetype)appearance;

@end
