//
//  UITableView+QMUIStaticCell.m
//  qmui
//
//  Created by MoLice on 2017/6/20.
//  Copyright © 2017年 QMUI Team. All rights reserved.
//

#import "UITableView+QMUIStaticCell.h"
#import "QMUICore.h"
#import "QMUIStaticTableViewCellDataSource.h"

@implementation UITableView (StaticCell)

+ (void)load {
    ReplaceMethod([UITableView class], @selector(setDelegate:), @selector(staticCell_setDelegate:));
    ReplaceMethod([UITableView class], @selector(setDataSource:), @selector(staticCell_setDataSource:));
}

static char kAssociatedObjectKey_staticCellDataSource;
- (void)setQmui_staticCellDataSource:(QMUIStaticTableViewCellDataSource *)qmui_staticCellDataSource {
    objc_setAssociatedObject(self, &kAssociatedObjectKey_staticCellDataSource, qmui_staticCellDataSource, OBJC_ASSOCIATION_RETAIN_NONATOMIC);
    qmui_staticCellDataSource.tableView = self;
}

- (QMUIStaticTableViewCellDataSource *)qmui_staticCellDataSource {
    return (QMUIStaticTableViewCellDataSource *)objc_getAssociatedObject(self, &kAssociatedObjectKey_staticCellDataSource);
}

- (void)staticCell_setDelegate:(id<UITableViewDelegate>)delegate {
    [self staticCell_setDelegate:delegate];
    if (delegate && self.qmui_staticCellDataSource) {
        // update delegate in qmui_staticCellDataSource
        self.qmui_staticCellDataSource.tableView = self;
    }
}

- (void)staticCell_setDataSource:(id<UITableViewDataSource>)dataSource {
    [self staticCell_setDataSource:dataSource];
    if (dataSource && self.qmui_staticCellDataSource) {
        // update dataSource in qmui_staticCellDataSource
        self.qmui_staticCellDataSource.tableView = self;
    }
}

@end
